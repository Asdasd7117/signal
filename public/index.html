<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Binance Live Chart</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    body { font-family: Arial; background: #111; color: #fff; text-align: center; }
    canvas { max-width: 1000px; margin: 20px auto; }
</style>
</head>
<body>
<h1>شارت BTC/USDT مباشر</h1>
<canvas id="myChart"></canvas>

<script>
async function fetchKlines() {
    const response = await fetch('/klines?symbol=BTCUSDT&interval=1m&limit=100');
    const data = await response.json();
    return data.map(k => ({
        time: new Date(k[0]),
        open: parseFloat(k[1]),
        high: parseFloat(k[2]),
        low: parseFloat(k[3]),
        close: parseFloat(k[4])
    }));
}

async function drawChart() {
    const klines = await fetchKlines();
    const ctx = document.getElementById('myChart').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'candlestick', // نستخدم candlestick إذا كان Chart.js يدعمها مع plugin
        data: {
            labels: klines.map(k => k.time.toLocaleTimeString()),
            datasets: [{
                label: 'BTC/USDT',
                data: klines.map(k => ({ o: k.open, h: k.high, l: k.low, c: k.close })),
                borderColor: 'green',
                backgroundColor: 'rgba(0,255,0,0.2)'
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: true, color: '#fff' } },
            scales: { x: { ticks: { color: '#fff' } }, y: { ticks: { color: '#fff' } } }
        }
    });
}

// تحديث الشارت كل دقيقة
drawChart();
setInterval(drawChart, 60000);
</script>
</body>
</html>
