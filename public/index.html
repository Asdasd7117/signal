<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ALGOX Live Binance Chart</title>
<style>
  body { margin: 0; font-family: Arial, sans-serif; background-color: #121212; color: #fff; }
  #chart { width: 100%; height: 90vh; }
</style>
<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
</head>
<body>
<h2 style="text-align:center;">ALGOX Live Binance Chart</h2>
<div id="chart"></div>

<script>
const chart = LightweightCharts.createChart(document.getElementById('chart'), {
    layout: { backgroundColor: '#121212', textColor: '#ffffff' },
    grid: { vertLines: { color: '#444' }, horzLines: { color: '#444' } },
    rightPriceScale: { borderColor: '#555' },
    timeScale: { borderColor: '#555', timeVisible: true, secondsVisible: true },
});

const candleSeries = chart.addCandlestickSeries({
    upColor: '#4CAF50',
    downColor: '#FF5252',
    borderVisible: false,
    wickUpColor: '#4CAF50',
    wickDownColor: '#FF5252',
});

const maSeries = chart.addLineSeries({ color: '#FFD700', lineWidth: 2 });

// ===== جلب بيانات Binance =====
async function fetchCandles(symbol='BTCUSDT', interval='1m', limit=100) {
    const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`;
    const response = await fetch(url);
    const data = await response.json();
    return data.map(d => ({
        time: d[0]/1000,
        open: parseFloat(d[1]),
        high: parseFloat(d[2]),
        low: parseFloat(d[3]),
        close: parseFloat(d[4]),
    }));
}

// ===== حساب MA =====
function calculateMA(data, period) {
    let result = [];
    for (let i = 0; i < data.length; i++) {
        if (i < period - 1) result.push({ time: data[i].time, value: null });
        else {
            let sum = 0;
            for (let j = i - period + 1; j <= i; j++) sum += data[j].close;
            result.push({ time: data[i].time, value: sum / period });
        }
    }
    return result;
}

// ===== تحديث الشارت =====
async function updateChart() {
    const candles = await fetchCandles();
    candleSeries.setData(candles);
    maSeries.setData(calculateMA(candles, 9));
}

updateChart();
setInterval(updateChart, 60000); // تحديث كل دقيقة
</script>
</body>
</html>
