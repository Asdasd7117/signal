<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Binance Real Chart</title>
<script src="https://cdn.jsdelivr.net/npm/lightweight-charts@3.7.0/dist/lightweight-charts.standalone.production.js"></script>
<style>
    body { margin: 0; padding: 0; }
    #chart { width: 100%; height: 500px; }
</style>
</head>
<body>
<div id="chart"></div>

<script>
async function fetchKlines() {
    const res = await fetch('/api/klines?symbol=BTCUSDT&interval=1m&limit=100');
    const data = await res.json();
    return data.map(k => ({
        time: k[0] / 1000,
        open: parseFloat(k[1]),
        high: parseFloat(k[2]),
        low: parseFloat(k[3]),
        close: parseFloat(k[4])
    }));
}

async function drawChart() {
    const chartData = await fetchKlines();
    const chart = LightweightCharts.createChart(document.getElementById('chart'), {
        layout: { backgroundColor: '#1e1e1e', textColor: '#ffffff' },
        grid: { vertLines: { color: '#333' }, horzLines: { color: '#333' } },
        rightPriceScale: { borderColor: '#555' },
        timeScale: { borderColor: '#555' }
    });

    const candleSeries = chart.addCandlestickSeries();
    candleSeries.setData(chartData);

    // تحديث البيانات كل دقيقة
    setInterval(async () => {
        const newData = await fetchKlines();
        candleSeries.setData(newData);
    }, 60000);
}

drawChart();
</script>
</body>
</html>
